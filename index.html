<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>StickFight — Single File</title>
  <style>
    /* Simple centered page */
    html,body{height:100%;margin:0;background:#111;color:#fff;font-family:system-ui,Segoe UI,Roboto,Arial}
    .wrap{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%}
    canvas{background:linear-gradient(#6db3ff,#1e3c72);display:block;border:6px solid #222;box-shadow:0 10px 30px rgba(0,0,0,.6)}
    .hud{width:800px;display:flex;justify-content:space-between;margin-top:12px}
    .bar{width:380px;background:#222;border-radius:6px;padding:6px}
    .bar-inner{height:18px;border-radius:4px;background:limegreen;width:100%}
    .info{color:#ddd;font-size:14px}
    .footer{margin-top:10px;color:#bbb;font-size:13px}
  </style>
</head>
<body>
  <div class="wrap">
    <canvas id="c" width="800" height="420"></canvas>
    <div class="hud">
      <div class="bar">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px">
          <div class="info">Player 1 (Blue)</div>
          <div class="info" id="p1hp">HP: 100</div>
        </div>
        <div class="bar-inner" id="p1bar"></div>
      </div>
      <div class="bar">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px">
          <div class="info">Player 2 (Red)</div>
          <div class="info" id="p2hp">HP: 100</div>
        </div>
        <div class="bar-inner" id="p2bar" style="background:tomato"></div>
      </div>
    </div>
    <div class="footer">Controls — Player1: A D (move) W (jump) S (attack). Player2: ← → (move) ↑ (jump) ↓ (attack). Refresh to restart.</div>
  </div>

<script>
// StickFight — minimal, single-file, easy to paste
const canvas = document.getElementById('c');
const ctx = canvas.getContext('2d');
const W = canvas.width, H = canvas.height;
const gravity = 0.9;

function clamp(v,a,b){return Math.max(a,Math.min(b,v));}

class Player{
  constructor(x,color,controls){
    this.x = x; this.y = H-80; this.vx = 0; this.vy = 0;
    this.w = 18; this.h = 40; this.color = color;
    this.onGround = false; this.facing = 1; // 1 right, -1 left
    this.hp = 100; this.maxHp = 100;
    this.attackTimer = 0; this.attackCooldown = 0;
    this.controls = controls; this.speed = 3.2; this.jumpStrength = -14;
  }
  rect(){return {x:this.x-this.w/2,y:this.y-this.h, w:this.w, h:this.h}};
  punchBox(){ // small rectangle in front when attacking
    const r = this.rect();
    return {x: r.x + (this.facing>0?r.w: -22), y: r.y + 6, w: 22, h: 12};
  }
}

// create two players
const p1 = new Player(170,'#0ea5ff',{left:'a',right:'d',jump:'w',attack:'s'});
const p2 = new Player(630,'#ff6b6b',{left:'ArrowLeft',right:'ArrowRight',jump:'ArrowUp',attack:'ArrowDown'});

const keys = {};
window.addEventListener('keydown', e=>{keys[e.key]=true; e.preventDefault();});
window.addEventListener('keyup', e=>{keys[e.key]=false; e.preventDefault();});

function applyInput(p){
  let left = keys[p.controls.left];
  let right = keys[p.controls.right];
  if(left && !right){ p.vx = -p.speed; p.facing = -1; }
  else if(right && !left){ p.vx = p.speed; p.facing = 1; }
  else p.vx = 0;

  if(keys[p.controls.jump] && p.onGround){ p.vy = p.jumpStrength; p.onGround = false; }

  if(keys[p.controls.attack] && p.attackCooldown<=0){ p.attackTimer = 12; p.attackCooldown = 30; }
}

function physics(p){
  p.vy += gravity * 0.8;
  p.x += p.vx;
  p.y += p.vy;
  // ground
  if(p.y > H-40){ p.y = H-40; p.vy = 0; p.onGround = true; }
  // walls
  p.x = clamp(p.x, 20, W-20);

  if(p.attackTimer>0) p.attackTimer--;
  if(p.attackCooldown>0) p.attackCooldown--;
}

function rectsOverlap(a,b){ return !(a.x+a.w < b.x || a.x > b.x+b.w || a.y+a.h < b.y || a.y > b.y+b.h); }

function handleCombat(){
  // if p1's attack hits p2
  if(p1.attackTimer>0){
    const hit = p1.punchBox(); if(rectsOverlap(hit, p2.rect())){ if(p1.attackTimer===1) { p2.hp -= 12; p2.hp = Math.max(0,p2.hp); } }
  }
  if(p2.attackTimer>0){
    const hit = p2.punchBox(); if(rectsOverlap(hit, p1.rect())){ if(p2.attackTimer===1) { p1.hp -= 12; p1.hp = Math.max(0,p1.hp); } }
  }
}

function drawPlayer(p){
  // shadow
  ctx.fillStyle = 'rgba(0,0,0,0.15)'; ctx.beginPath(); ctx.ellipse(p.x, H-20, 26, 8, 0,0,Math.PI*2); ctx.fill();
  // body (simple stick)
  const r = p.rect();
  ctx.strokeStyle = p.color; ctx.lineWidth = 3; ctx.lineCap = 'round';
  // head
  ctx.beginPath(); ctx.arc(p.x, r.y - 12, 8, 0, Math.PI*2); ctx.stroke();
  // body line
  ctx.beginPath(); ctx.moveTo(p.x, r.y - 4); ctx.lineTo(p.x, r.y + 16); ctx.stroke();
  // arms
  ctx.beginPath(); ctx.moveTo(p.x - 12, r.y + 4); ctx.lineTo(p.x + 12, r.y + 4); ctx.stroke();
  // legs
  ctx.beginPath(); ctx.moveTo(p.x, r.y + 16); ctx.lineTo(p.x - 8, r.y + 36); ctx.moveTo(p.x, r.y + 16); ctx.lineTo(p.x + 8, r.y + 36); ctx.stroke();

  // draw attack box when active (small flash)
  if(p.attackTimer>0){ const hb = p.punchBox(); ctx.fillStyle = p.color; ctx.globalAlpha = 0.18; ctx.fillRect(hb.x, hb.y, hb.w, hb.h); ctx.globalAlpha = 1 }
}

function render(){
  // sky gradient background is from CSS; still clear
  ctx.clearRect(0,0,W,H);
  // simple ground
  ctx.fillStyle = '#2b572d'; ctx.fillRect(0,H-40,W,40);

  drawPlayer(p1); drawPlayer(p2);

  // center text if someone wins
  if(p1.hp<=0 || p2.hp<=0){
    ctx.fillStyle = 'rgba(0,0,0,0.5)'; ctx.fillRect(0,0,W,H);
    ctx.fillStyle = '#fff'; ctx.font = '36px system-ui'; ctx.textAlign='center';
    const winner = p1.hp<=0 && p2.hp<=0 ? 'Draw' : p1.hp>p2.hp ? 'Player 1 Wins!' : 'Player 2 Wins!';
    ctx.fillText(winner, W/2, H/2 - 10);
    ctx.font = '16px system-ui'; ctx.fillText('Refresh page to play again', W/2, H/2 + 22);
  }
}

function updateHud(){
  document.getElementById('p1hp').innerText = 'HP: ' + Math.max(0,p1.hp);
  document.getElementById('p2hp').innerText = 'HP: ' + Math.max(0,p2.hp);
  document.getElementById('p1bar').style.width = (p1.hp/p1.maxHp*100) + '%';
  document.getElementById('p2bar').style.width = (p2.hp/p2.maxHp*100) + '%';
}

function gameLoop(){
  if(p1.hp>0 && p2.hp>0){
    applyInput(p1); applyInput(p2);
    physics(p1); physics(p2);
    handleCombat();
  }
  render(); updateHud();
  requestAnimationFrame(gameLoop);
}

// tiny AI for idle second player if no keys pressed for p2
let idleCounter = 0;
setInterval(()=>{
  // detect no input for p2
  const noInput = !keys[p2.controls.left] && !keys[p2.controls.right] && !keys[p2.controls.attack] && !keys[p2.controls.jump];
  if(noInput) idleCounter++; else idleCounter = 0;
  if(idleCounter>300 && p2.hp>0 && p1.hp>0){ // simple chase
    if(Math.abs(p2.x - p1.x) > 70){ p2.vx = (p1.x<p2.x)? -1.8 : 1.8; p2.facing = (p1.x<p2.x)? -1:1; }
    if(p2.onGround && Math.random()<0.02) p2.vy = -12;
    if(Math.random()<0.01) { p2.attackTimer = 12; p2.attackCooldown = 30; }
  }
}, 200);

// start
gameLoop();
</script>
</body>
</html>
